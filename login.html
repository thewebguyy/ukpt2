<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Login - Customise Me UK</title>
  <link rel="stylesheet" href="admin-styles.css">
</head>
<body>
  <div class="login-container">
    <div class="login-box">
      <h1>Customise Me UK</h1>
      <h2>Admin Portal</h2>
      
      <form id="loginForm">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            required 
            placeholder="admin@customisemeuk.com"
            autocomplete="email"
          >
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            required 
            placeholder="Enter your password"
            autocomplete="current-password"
            minlength="6"
          >
        </div>

        <button type="submit" class="btn btn-primary" id="loginBtn">
          <span id="loginText">Sign In</span>
          <span id="loginSpinner" class="spinner" style="display: none;"></span>
        </button>
      </form>

      <div id="errorMessage" class="error-message" style="display: none;"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // ========================================
    // FIREBASE CONFIGURATION
    // ========================================
    const firebaseConfig = {
      apiKey: "AIzaSyA6pLJdRb4V5LUUrHdwSKRne-ZgXJoqqY8",
      authDomain: "cmuksite.firebaseapp.com",
      projectId: "cmuksite",
      storageBucket: "cmuksite.firebasestorage.app",
      messagingSenderId: "311601861870",
      appId: "1:311601861870:web:4d3c04c418a789961dcfff"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // ========================================
    // AUTH STATE OBSERVER
    // ========================================
    // Redirect to dashboard if already logged in
    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = 'dashboard.html';
      }
    });

    // ========================================
    // LOGIN FORM HANDLER
    // ========================================
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const loginText = document.getElementById('loginText');
    const loginSpinner = document.getElementById('loginSpinner');
    const errorMessage = document.getElementById('errorMessage');

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      // Validate inputs
      if (!email || !password) {
        showError('Please enter both email and password.');
        return;
      }

      // Show loading state
      setLoading(true);
      hideError();

      try {
        // Sign in with Firebase Auth
        await signInWithEmailAndPassword(auth, email, password);
        
        // Success - redirect will happen via onAuthStateChanged
        console.log('Login successful');
        
      } catch (error) {
        console.error('Login error:', error);
        
        // Handle specific Firebase auth errors
        let errorMsg = 'Login failed. Please try again.';
        
        switch (error.code) {
          case 'auth/user-not-found':
            errorMsg = 'No account found with this email address.';
            break;
          case 'auth/wrong-password':
            errorMsg = 'Incorrect password. Please try again.';
            break;
          case 'auth/invalid-email':
            errorMsg = 'Invalid email address format.';
            break;
          case 'auth/user-disabled':
            errorMsg = 'This account has been disabled.';
            break;
          case 'auth/too-many-requests':
            errorMsg = 'Too many failed attempts. Please try again later.';
            break;
          case 'auth/network-request-failed':
            errorMsg = 'Network error. Please check your connection.';
            break;
          case 'auth/invalid-credential':
            errorMsg = 'Invalid email or password. Please try again.';
            break;
          default:
            errorMsg = error.message || 'An unexpected error occurred.';
        }
        
        showError(errorMsg);
        setLoading(false);
      }
    });

    // ========================================
    // HELPER FUNCTIONS
    // ========================================
    function setLoading(isLoading) {
      loginBtn.disabled = isLoading;
      loginText.style.display = isLoading ? 'none' : 'inline';
      loginSpinner.style.display = isLoading ? 'inline-block' : 'none';
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function hideError() {
      errorMessage.style.display = 'none';
    }

    // Clear error on input
    emailInput.addEventListener('input', hideError);
    passwordInput.addEventListener('input', hideError);
  </script>
</body>
</html>